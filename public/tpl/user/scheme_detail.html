<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>互联网首个设计师专单平台|装修效果图|装修流程|施工监理_简繁家</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="description" content="简繁家提供家装设计、新房装修、装修流程、室内设计、家装设计、室内装修、施工监理等服务和装修知识、装修风格、装修效果图、装修设计图等信息。">
	<meta name="keywords" content="室内装修,装修流程,装修知识,装修效果图,家装施工监理">
	<link rel="stylesheet" type="text/css" href="../../static/css/public.css" />
	<link rel="stylesheet" type="text/css" href="../../static/css/user.css" />
	<script type="text/javascript" src="../../static/js/lib/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="../../static/js/lib/public.js"></script>
	<script type="text/javascript" src="../../static/js/lib/page.js"></script>
</head>
<body>
	<div class="g-hd">
		<div class="g-wp f-cb">
			<div class="m-logo f-fl">
				<h1><a href="../index/index.html">简繁家</a></h1>
			</div>
			<div class="f-fr">
				<div class="user">
					<a href="../user/login.html">登录</a>/<a href="../user/reg.html">注册</a>
				</div>
				<ul class="m-nav f-fl">
					<li class="active"><a href="../index/index.html">首页</a></li>
					<li><a href="../design/index.html">设计师</a></li>
					<li><a href="../live/index.html">装修直播</a></li>
					<li><a href="../merit/index.html">为什么选简繁家</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="g-scheme" id="j-scheme">
		<div class="m-scheme">
			<div class="scheme-tab f-cb">
				<ul class="f-fl">
					<li class="active">查看方案</li>
					<li>查看报价</li>
				</ul>
				<a href="javascript:history.go(-1);" class="return f-fr"><i class="iconfont">&#xe61e;</i>返回</a>
			</div>
			<div class="scheme-box">
				<div class="scheme-list scheme-show">
					<div class="case" id="j-case">
						<div class="title"></div>
						<div class="desc">
							<h3>案例简介 Case description</h3>
							<p></p>
						</div>
						<div class="casepic"></div>
						<div class="comment" id="comment">
							<div class="tt">
								<h3 class="f-fl">留言评论</h3>
								<p class="f-fr" id="comment-size"></p>
							</div>
							<div class="reply">
								<div class="textarea">
									<textarea name="" id="comment-textarea" cols="30" rows="10"></textarea>
								</div>
								<div class="publish">
									<p class="f-fl">
										只有当前装修方案的装修业主和设计师可见
									</p>
									<a href="javascript:void(0)" id="publish_btn" >发表评论</a>
								</div>
							</div>
							<ul class="list"></ul>
							<div class="m-page" id="j-page"></div>
						</div>
					</div>
					<div class="design" id="j-scheme-design"></div>
				</div>
				<div class="scheme-list hide">
					<div class="m-table" id="j-item">
						<table>
							<thead>
								<tr>
									<th class="td1">项目名称</th>
									<th class="td2">项目价格</th>
									<th class="td3">备注说明</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td class="td1">基础工程</td>
									<td class="td2">3000元</td>
									<td class="td3">项目：暗香，人数20人</td>
								</tr>
								<tr>
									<td class="td1">水电工程</td>
									<td class="td2">3000元</td>
									<td class="td3">顶面基层处理，顶面乳胶漆，墙面基层处理，墙面乳胶漆，石膏板造型吊顶，地面找平，电视背景墙鞋柜及挂衣板</td>
								</tr>
								<tr>
									<td class="td1">客餐厅及走道</td>
									<td class="td2">3000元</td>
									<td class="td3">顶面基层处理，顶面乳胶漆，墙面基层处理，墙面乳胶漆，石膏板造型吊顶，地面找平，电视背景墙鞋柜及挂衣板</td>
								</tr>
								<tr>
									<td class="td1">基础工程</td>
									<td class="td2">3000元</td>
									<td class="td3">项目：暗香，人数20人</td>
								</tr>
								<tr>
									<td class="td1">水电工程</td>
									<td class="td2">3000元</td>
									<td class="td3">顶面基层处理，顶面乳胶漆，墙面基层处理，墙面乳胶漆，石膏板造型吊顶，地面找平，电视背景墙鞋柜及挂衣板</td>
								</tr>
								<tr>
									<td class="td1">客餐厅及走道</td>
									<td class="td2">3000元</td>
									<td class="td3">顶面基层处理，顶面乳胶漆，墙面基层处理，墙面乳胶漆，石膏板造型吊顶，地面找平，电视背景墙鞋柜及挂衣板</td>
								</tr>
								<tr>
									<td class="td1">基础工程</td>
									<td class="td2">3000元</td>
									<td class="td3">项目：暗香，人数20人</td>
								</tr>
								<tr>
									<td class="td1">水电工程</td>
									<td class="td2">3000元</td>
									<td class="td3">顶面基层处理，顶面乳胶漆，墙面基层处理，墙面乳胶漆，石膏板造型吊顶，地面找平，电视背景墙鞋柜及挂衣板</td>
								</tr>
								
							</tbody>
						</table>
						<div class="price"></div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="g-ft">
		<div class="m-sitemap f-cb">
			<div class="g-wp">
				<div class="sitemap f-fl">
					<dl>
						<dt>业主指南</dt>
						<dd><a href="">提交需求</a></dd>
						<dd><a href="">预约设计师</a></dd>
					</dl>
					<dl>
						<dt>设计师指南</dt>
						<dd><a href="">设计师认证</a></dd>
						<dd><a href="">入驻协议</a></dd>
						<dd><a href="">上传作品</a></dd>
						<dd><a href="">上门量房</a></dd>
					</dl>
					<dl>
						<dt>关于我们</dt>
						<dd><a href="">关于我们</a></dd>
						<dd><a href="">联系我们</a></dd>
					</dl>
				</div>
				<div class="erweima f-fr">
					<img src="../../img/public/erweima.jpg" alt="" />
				</div>
			</div>
		</div>
		<div class="m-copy">
			<div class="g-wp">
			Copyright © 2015-2025 jianfanjia.com All Rights Reserved 武汉家易装科技有限公司 隐私权政策 鄂ICP备15014103号
			</div>
		</div>
	</div>
</body>
</html>
<script type="text/javascript">
	var $scheme = $('#j-scheme');
	var $schemeTab = $scheme.find('.scheme-tab').find('li');
	var $schemeList = $scheme.find('.scheme-list');
	var $schemeDesign = $('#j-scheme-design');
	var $comment = $('#comment');
	var $case = $('#j-case');
	var $item = $('#j-item');
	var arr = [$schemeDesign.offset().top,$schemeDesign.offset().left]
	$(window).on('scroll',function(){
		var winT = $(window).scrollTop();
		if(winT > arr[0]){
			$schemeDesign.addClass('fixed').css({'top':0,'right':'auto','left':arr[1]})
		}else{
			$schemeDesign.removeClass('fixed').css({'top':0,'right':-264,'left':'auto'})
		}
	});
	$schemeTab.on('click',function(){
		var index = $(this).index();
		$(this).attr('class','active').siblings().attr('class', '');
		$schemeList.eq(index).removeClass('hide').siblings().addClass('hide');
	});

	var $textarea = $('#comment-textarea');
	var winHash = window.location.search.substring(1);
	$('#publish_btn').on('click',function(){
		if(!!$.trim($textarea.val())){
			var url = RootUrl+'api/v1/plan/comment';
			$.ajax({
				url:url,
				type: 'POST',
				contentType : 'application/json; charset=utf-8',
				dataType: 'json',
				data : JSON.stringify({
				  "planid":winHash,
				  "content":$textarea.val()
				}),
				processData : false,
				success: function(res){
					if(res['msg'] === 'success'){
						loadList()
						$textarea.val('');
						$('body,html').animate({scrollTop:$comment.offset().top},1000);
					}
			   	}
			});
		}else{
			alert('请填写留言内容')
		}
	})
	loadList()
	function loadList(){
		var url = RootUrl+'api/v1/plan/'+winHash;
		$.ajax({
			url:url,
			type: 'GET',
			contentType : 'application/json; charset=utf-8',
			dataType: 'json',
			success: function(res){
				if(res['data']){
					createInfo(res['data'])
				}
		   	}
		});
	}
	var $title = $case.find('.title');
	var $desc = $case.find('.desc').find('p');
	var $casepic = $case.find('.casepic');
	function createInfo(data){
		$schemeDesign.html("")
		$title.html("");
		$desc.html("");
		$casepic.html("");
		var title = '<h2>'+data.manager+'的方案</h2><p>报价：<strong>'+data.total_price+'万元</strong><span>|</span>风格：'+data.manager+'<span>|</span>空间：'+data.manager+'<span>|</span>面积：'+data.manager+'m&sup2;</p>';
		var casepic = '<div class="casepic">'
		if(data.images.length == 0){
			casepic += '暂无方案图片'
		}
		for (var i = 0; i < data.images.length; i++) {
			casepic += '<img src="'+RootUrl+'api/v1/image/'+data.images[i]+'" alt="" />'
		};
		casepic += '</div>'
		$title.html(title);
		$desc.html(data.description || "暂无方案描述");
		$casepic.html(casepic);
		
		
		if(data.comments.length){
			var info = getInfo(data.comments)
			page(data.comments.reverse(),info)
		}
		$('#comment-size').html(data.comments.length+'条留言')
		getPriceDetail(data.price_detail)
		var url = RootUrl+'api/v1/designer/'+data.designerid+'/basicinfo';
		$.ajax({
			url:url,
			type: 'GET',
			contentType : 'application/json; charset=utf-8',
			dataType: 'json',
			async : false,
			success: function(res){
				var resData = res['data']
				if(resData){
					var img = resData.imageid === "" ? '../../static/img/public/headpic.jpg' : RootUrl+'api/v1/image/'+resData.imageid;
						var schemeDesign = '<a class="head" href="../design/homepage.html?'+resData._id+'"><img src="'+img+'" alt="" /></a>'
												+'<h4>'+resData.username+'<i class="iconfont">&#xe60b;</i></h4>'
												+'<div class="auth">'
													+'<i class="iconfont">&#xe60b;</i>认证设计师'
												+'</div>'
												+'<div class="info f-cb">'
													+'<dl class="f-fl">'
														+'<dt>'+resData.product_count+'</dt>'
														+'<dd>作品</dd>'
													+'</dl>'
													+'<span class="f-fl"></span>'
													+'<dl class="f-fl">'
														+'<dt>'+resData.order_count+'</dt>'
														+'<dd>预约</dd>'
													+'</dl>'
												+'</div>'
						$schemeDesign.html(schemeDesign)
				}
		   	}
		});
		
	}
	var $itemprice = $item.find('.price');
	var $itemTbody = $item.find('tbody');
	function getPriceDetail(data){
		$itemTbody.html('');
		$itemprice.html('');
		var str = '';
		for (var i = 0; i < data.length; i++) {
			if(data[i].item === "工程总造价"){
				$item.append('<p>工程总造价：<span>'+number_format(data[i].price,0,".",",")+'元</span>（不含设计费）</p>')
			}else if(data[i].item === "项目总造价"){
				$item.append('<p>项目总造价：<span>'+number_format(data[i].price,0,".",",")+'元</span>（含设计费）</p>')
			}else{
				str += '<tr><td class="td1">'+data[i].item+'</td><td class="td2">'+number_format(data[i].price,0,".",",")+'元</td><td class="td3">'+(data[i].description ? data[i].description : "")+'</td></tr>'
			}
		};
		$itemTbody.html(str)
	}
	function createList(data,info){
		var img = info.imageid === "" ? '../../static/img/public/headpic.jpg' : RootUrl+'api/v1/image/'+info.imageid
		return  '<li>'
					+'<div class="pic">'
						+'<img src="'+img+'" alt="" />'
					+'</div>'
					+'<h4>'
						+'<strong>'+info.username+'</strong>'
						+'<span>'+timeFormat(data.date)+'</span>'
						+'<a href="javascript:;" class="reply-btn"><i class="iconfont">&#xe612;</i>回复</a>'
					+'</h4>'
					+'<p>'+data.content+'</p>'
				+'</li>'
	}
	
	function getInfo(by){
		var infoArr = [];
		for (var i = 0; i < by.length; i++) {
			var url = RootUrl+'api/v1/designer/'+by[i].by+'/basicinfo';
			$.ajax({
				url:url,
				type: 'GET',
				contentType : 'application/json; charset=utf-8',
				dataType: 'json',
				async : false,
				success: function(res){
					if(res['data']){
						infoArr.push(res['data'])
					}
			   	}
			});
		};
		return infoArr
	}
	//生成分页
	function page(arr,info){
		var page = new Pageing({
			id : 'j-page',
			allNumPage : arr.length,
			itemPage : 5,
			showPageNum : 9,
			endPageNum : 1,
			currentPage : 0,
			linkTo : '',
			callback : function(num,obj){
				if(this.allNumPage > 0){
					var maxElem = Math.min((num+1)*this.itemPage , this.allNumPage)
					$comment.find('.list').html('');
					for(var i=num*this.itemPage;i<maxElem;i++){
						$comment.find('.list').append(createList(arr[i],info[i]));
					}
					$comment.find('li:odd').attr('class', 'even');
					obj.find('.btns').on('click' , function(ev){
						ev.stopPropagation();
						$('body,html').animate({scrollTop:$comment.offset().top},1000);
					});
				}
				return false;
			}
		});
	};
    //方案预览
	$comment.delegate('.reply-btn','click',function(ev){
		ev.preventDefault();
		$('body,html').animate({scrollTop:$comment.offset().top},1000);
	})
	function timeFormat(time){    //格式化个性时间
	    var date = new Date(time),
	        curDate = new Date(),
	        year = date.getFullYear(),
	        month = date.getMonth() + 10,
	        day = date.getDate(),
	        hour = date.getHours(),
	        minute = date.getMinutes(),
	        curYear = curDate.getFullYear(),
	        curHour = curDate.getHours(),
	        timeStr;
	 
	    if(year < curYear){
	        timeStr = year +'年'+ month +'月'+ day +'日 '+ hour +':'+ minute;
	    }else{
	        var pastTime = curDate - date,
	            pastH = pastTime/3600000;
	 
	        if(pastH > curHour){
	              timeStr = month +'月'+ day +'日 '+ hour +':'+ minute;
	        }else if(pastH >= 1){
	              timeStr = '今天 ' + hour +':'+ minute +'分';
	        }else{
	              var pastM = curDate.getMinutes() - minute;
	              if(pastM > 1){
	                timeStr = pastM +'分钟前';
	              }else{
	                timeStr = '刚刚';
	              }
	        }
	    }
	    return timeStr;
	}
	function number_format(number, decimals, dec_point, thousands_sep) {
	    number = (number + '').replace(/[^0-9+-Ee.]/g, '');
	    var n = !isFinite(+number) ? 0 : +number,
	        prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
	        sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
	        dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
	        s = '',
	        toFixedFix = function (n, prec) {
	            var k = Math.pow(10, prec);
	            return '' + Math.ceil(n * k) / k;
	        };
	 
	    s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
	    var re = /(-?\d+)(\d{3})/;
	    while (re.test(s[0])) {
	        s[0] = s[0].replace(re, "$1" + sep + "$2");
	    }
	 
	    if ((s[1] || '').length < prec) {
	        s[1] = s[1] || '';
	        s[1] += new Array(prec - s[1].length + 1).join('0');
	    }
	    return s.join(dec);
	}
</script>