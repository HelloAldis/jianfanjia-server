<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>互联网首个设计师专单平台|装修效果图|装修流程|施工监理_简繁家</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="description" content="简繁家提供家装设计、新房装修、装修流程、室内设计、家装设计、室内装修、施工监理等服务和装修知识、装修风格、装修效果图、装修设计图等信息。">
	<meta name="keywords" content="室内装修,装修流程,装修知识,装修效果图,家装施工监理">
	<link rel="stylesheet" type="text/css" href="../../static/css/public.css" />
	<link rel="stylesheet" type="text/css" href="../../static/css/user.css" />
	<script type="text/javascript" src="../../static/js/lib/jquery-1.11.1.min.js"></script>
	<script type="text/javascript" src="../../static/js/lib/public.js"></script>
	<script type="text/javascript" src="../../static/js/lib/jquery.uploadify-3.1.js"></script>
	<script type="text/javascript" src="../../static/js/lib/jquery.Huploadify.js"></script>
			<!--[if lt IE 9]>
      <script type="text/javascript" src="../../static/js/lib/json2-min.js"></script>
    <![endif]-->
     <!--[if lt IE 8]>
      <script type="text/javascript">
      	if(!-[1,]){window.location.href = "../other/error.html";} 
      </script>
    <![endif]-->
</head>
<body>
	<div class="g-hd">
		<div class="g-wp f-cb">
			<div class="m-logo f-fl">
				<h1><a href="../index/index.html">简繁家</a></h1>
			</div>
			<div class="f-fr">
				<div class="user" id="j-userLogin">
					<a href="../user/login.html">登录</a>/<a href="../user/reg.html">注册</a>
				</div>
				<ul class="m-nav f-fl">
					<li class="active"><a href="../index/index.html">首页</a></li>
					<li><a href="../design/index.html">设计师</a></li>
					<li><a href="../live/index.html">装修直播</a></li>
					<li><a href="../merit/index.html">为什么选简繁家</a></li>
				</ul>
			</div>
		</div>
	</div>
	<div class="g-scheme" id="j-scheme">
		<div class="m-scheme">
			<div class="scheme-tab f-cb">
				<ul class="f-fl">
					<li class="active">提交方案</li>
					<li>在线报价</li>
				</ul>
				<a href="javascript:history.go(-1);" class="return f-fr"><i class="iconfont">&#xe61e;</i>返回</a>
			</div>
			<div class="scheme-box">
				<div class="scheme-list">
					<div class="w-form user-form scheme_create" id="j-scheme_create">
						<div class="m-item f-cb">
							<div class="item">
								<label class="u-lab" for="userName">业主姓名：</label>
								<div class="u-inp">
									<div class="name" id="userName"></div>
								</div>
							</div>
						</div>
						<div class="m-item f-cb">
							<div class="item">
								<label class="u-lab" for="scheme-cycle">工&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;期：</label>
								<div class="u-inp">
									<div class="box">
										<input type="text" class="input" name="scheme-cycle" id="scheme-cycle" />
										<span class="unit">天</span>
									</div>
								</div>
							</div>
							<p class="tips-icon tips-icon-ok hide"><i class="iconfont">&#xe616;</i></p>
							<p class="tips-icon tips-icon-err hide"><i class="iconfont">&#xe611;</i></p>
							<p class="tips-info hide"></p>
						</div>
						<div class="m-item f-cb" id="scheme-price-box">
							<div class="item">
								<label class="u-lab" for="scheme-price">报&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价：</label>
								<div class="u-inp">
									<div class="box">
										<span id="scheme-price"></span>
										<span class="unit" id="outcry"><i class="iconfont">&#xe61a;</i></span>
									</div>
								</div>
							</div>
							<p class="tips-info hide"></p>
						</div>
						<div class="m-item f-cb">
							<div class="item">
								<label class="u-lab" for="scheme-description">方案说明：</label>
								<div class="u-inp">
									<div class="textarea"><textarea name="scheme-description" id="scheme-description" cols="30" rows="10"></textarea></div>
								</div>
							</div>
							<p class="tips-info hide"></p>
						</div>
						<div class="m-item f-cb" id="pmobj-box">
							<div class="item">
								<label class="u-lab" for="dec_area">项目经理：</label>
								<div class="u-inp">
									<div class="m-select" id="pmobj"></div>
								</div>
							</div>
							<p class="tips-info hide"></p>
						</div>
						<div class="m-item f-cb">
							<div class="item" id="j-file-list">
								<label class="u-lab" for="work_type">上传平面图：</label>
								<div class="u-inp">
									<div class="file">
										<p class="tips">*作品上传每张大小为3M以内</p>
										<div class="file-list f-cb">
											<div class="create-item">
												<div class="pic" id="upload">
													<div class="fileBtn">
														<input class="hide" id="fileToUpload" type="file" name="upfile">
														<p class="hide"><a href="javascript:$('#fileToUpload').uploadify('settings', 'formData', {'typeCode':document.getElementById('id_file').value});$('#fileToUpload').uploadify('upload','*')">上传</a>
														<a href="javascript:$('#fileToUpload').uploadify('cancel','*')">重置上传队列</a>
														</p>
														<input type="hidden" id="sessionId" value="${pageContext.session.id}" />
														<input type="hidden" value="1215154" name="tmpdir" id="id_file">
													</div>
													<img src="../../static/img/user/uploadify.jpg" alt="" />
												</div>
											</div>
										</div>
									</div>
								</div>
								<p class="tips-info hide"></p>
							</div>
						</div>
						<div class="m-item m-error-info hide">
						</div>
						<div class="m-item">
							<div class="u-btn">
								<a href="javascript:;" class="btn" id="scheme-submit">提交方案</a>
								<a href="javascript:;" class="btn hide" id="scheme-editor">修改方案</a>
							</div>
						</div>
				</div>	
				</div>
				<div class="scheme-list hide">
					<div class="scheme-item" id="j-scheme-item">
						<table>
							<thead>
								<tr>
									<th class="td1">项目名称</th>
									<th class="td2">项目总价(元)</th>
									<th class="td3">备注说明</th>
									<th class="td4">操作</th>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot></tfoot>
						</table>
						<div class="allPrice"></div>
						<a href="javascript:;" class="btn" id="create-quotes">创建报价</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="g-ft">
		<div class="m-sitemap f-cb">
			<div class="g-wp">
				<div class="sitemap f-fl">
					<dl>
						<dt>业主指南</dt>
						<dd><a href="../guide/index.html?0">业务流程</a></dd>
						<dd><a href="../guide/index.html?1">三方保障合同</a></dd>
					</dl>
					<dl>
						<dt>设计师指南</dt>
						<dd><a href="../guide/design.html?0">设计师认证</a></dd>
						<dd><a href="../guide/design.html?1">作品上传</a></dd>
						<dd><a href="../guide/design.html?2">上门沟通及量房</a></dd>
						<dd><a href="../guide/design.html?3">设计师入驻协议</a></dd>
					</dl>
					<dl>
						<dt>关于我们</dt>
						<dd><a href="../about/index.html#about">关于我们</a></dd>
						<dd><a href="../about/index.html#contact">联系我们</a></dd>
					</dl>
				</div>
				<div class="erweima f-fr">
					<img src="../../img/public/erweima.jpg" alt="" />
				</div>
			</div>
		</div>
		<div class="m-copy">
			<div class="g-wp">
			Copyright © 2015-2025 jianfanjia.com All Rights Reserved 武汉家易装科技有限公司 隐私权政策 鄂ICP备15014103号
			</div>
		</div>
	</div>
	<style type="text/css">
		#outcry{
			width: 100%;
			text-align: right;
		}
	</style>
</body>
</html>
<script type="text/javascript">
//创建报价
	;(function($){
		function OnlinePrice(options){
			var self = this;
			this.win = $(window);
			this.doc = $(document);
			this.body = $(document.body);
			$.extend(this.settings = {
				id : null,
				data : [],
				list : ['次卧','客卧','衣帽间','书房','主卫','客卫','阳台一','阳台二']
			},options || {});
			this.listArr = this.settings.list;
			this.countId = 0;
			this.PriceBox = $('#'+this.settings.id);
			this.tBody = this.PriceBox.find('tbody');
			this.tFoot = this.PriceBox.find('tfoot');
			this.createItem = this.PriceBox.find('.createItem');
			this.allPrice = this.PriceBox.find('.allPrice');
			this.createTrList(this.settings.data);
			this.createTrEvent();
			this.deleteTrEvent();
			this.reckonTrPrice();
			this.reckonAllPrice();
			this.inputBlur();
			this.pupop = $('<div class="m-newItem"><h3>添加新项目</h3><span class="close"></span><div class="list"></div><div class="custom"></div></div>')
			this.body.append(this.pupop)
		}
		OnlinePrice.prototype = {
			createTrData : function(data,color,order){
				var self = this;
				var oBtn = true;
				var oTr = $('<tr id="'+(data.item === '主卧' ? "addTo" : "")+' class="'+(color ? "color" : "")+'">');
				oTr.append($('<td class="td1">'+data.item+'</td>'));
				oTr.append($('<td class="td2"><div class="inp"><input class="price" type="text" name="'+this.settings.id+"-num-"+self.countId+'" id="'+this.settings.id+"-num-"+self.countId+'" placeholder="请输入整数金额" value="'+(data.price == 0 ? "" : data.price)+'" /></div></td>'));
				oTr.append($('<td class="td3"><div class="textarea"><textarea name="'+this.settings.id+"-con-"+this.countId+'" id="'+this.settings.id+"-con-"+this.countId+'" cols="30" rows="10">'+(data.description ? data.description : '')+'</textarea></div></td>'));
				if(data.item === '主卧'){
					oTr.append($('<td class="td4"><a href="javascript:;" class="add"><span></span><em></em></a></td>'))
				}else if(data.item === '设计费'){
					oTr.append($('<td class="td4"></td>'))
				}else{	
					oTr.append($('<td class="td4"><a href="javascript:;" class="remove"><em></em></a></td>'))
				}
				if(data.item === '设计费'){
					this.tFoot.append(oTr);
				}else{
					if(!!order){
						if(oBtn){
							oBtn = false;
							$("#addTo").after(oTr);
						}else{
							$("#addTo").next().eq(0).before(oTr);
						}
					}else{
						this.tBody.append(oTr);
					}
				}			
			},
			newTrList : function(){
				var self = this;
				var sHtml = ''
				for (var i = 0,len = this.listArr.length; i < len; i++) {
					sHtml+= '<a href="javascript:;" class="btns">'+this.listArr[i]+'</a>'
				};
				this.pupop.find('.list').html(sHtml);
				var aBtn = this.pupop.find('.btns');
				aBtn.on('click',function(){
					var index = $(this).index();
					this.countId++;
					self.createTrData({"item": $(this).html(), "price": 0,"description":""},true,true) 
					self.listArr.splice(index,1);
					self.pupop.hide();
				})
			},
			customTrList : function(){
				var self = this;
				var sHtml = '自定义：<br /><input type="text" id="customVal" /><input type="button" id="customBtn" value="添加新项目" />'
				this.pupop.find('.custom').html(sHtml);
				$('#customBtn').on('click',function(){
					var value = $('#customVal').val()
					if(!!$.trim(value)){
						self.createTrData({"item": value, "price": 0,"description":""},true);
						self.pupop.hide();
					}else{
						alert('请输入新添加项目名称')
					}
				})
			},
			closeTrList : function(){
				var self = this;
				var close = self.pupop.find('.close');
				close.on('click',function(){
					self.pupop.hide();
				})
			},
			createTrEvent : function(){
				var self = this;
				this.PriceBox.delegate('.add','click',function(){
					self.countId++;
					self.newTrList();
					self.customTrList();
					self.pupop.show();
					self.closeTrList();
				})
			},
			newTrItem : function(){
				var self = this;
				var list = this.settings.list;
				var sBtns = '';
				for(var i = 0; i < list.length; i++) {
					sBtns += '<a href="javascript:;">'+list[i]+'</a>'
				};
				this.pupop.html(sBtns)
				
			},
			deleteTrEvent : function(){
				var self = this;
				this.PriceBox.delegate('.remove','click',function(ev){
					ev.stopPropagation();
					if (confirm("你确定删除吗？")) {  
			            $(this).closest('tr').remove();
			            self.reckonAllPrice(); 
			        }
				})
			},
			inputBlur : function(){
				this.PriceBox.delegate('.price','blur',function(ev){
					ev.stopPropagation();
					var  value = $(this).val();
					var reg = /^[1-9]*[1-9][0-9]*$/
					if(!!$.trim(value)){
						if(value != 0){
							if(!reg.test(value)){
								alert('请输入整数金额');
								$(this).val('');
							}
						}
					}
				})
			},
			createTrList : function(data){
				for (var i = 0; i < data.length; i++) {
					this.countId = i;
					this.createTrData(data[i])
				};
			},
			reckonTrPrice : function(){
				var self = this;
				this.PriceBox.delegate('tr','focus blur input keyup propertychange resetplaceholder',function(ev){
					ev.stopPropagation();
					self.reckonAllPrice();			 
				})
			},
			reckonAllPrice : function(){
				var self = this;
				var aPrice = this.tBody.find('input');
				var oDesign = parseInt(this.tFoot.find('input').val());
				var price = 0;
				aPrice.each(function(i,el){
					price += isNaN(parseInt(aPrice.eq(i).val())) || parseInt(aPrice.eq(i).val()) === '' ? 0 : parseInt(aPrice.eq(i).val());
				})
				all = price+oDesign;	
				var html = '<p>工程总造价：<span id="itemprice">'+(number_format(price,0,".",","))+'</span>元（不含设计费）</p>'
							+'<p>项目总造价：<span id="allPrice">'+number_format(all,0,".",",")+'</span>元（含设计费）</p>'
				this.allPrice.html(html)
			}
		}
		window["OnlinePrice"] = OnlinePrice;
	})(jQuery);
		var winHash = window.location.search.substring(1).split("&");
		var userid = winHash[0].split("=")[1];
		var userName = decodeURI(winHash[1].split("=")[1]);
		if(!!winHash[2]){
			submitScheme()
		}else{
			loadList();
		}
		
	var $scheme = $('#j-scheme');
	var $schemeTab = $scheme.find('.scheme-tab').find('li');
	var $schemeList = $scheme.find('.scheme-list');
	var $schemeDesign = $('#j-scheme-design');
	var $fileListBox = $('#j-file-list');
	var $fileList = $fileListBox.find('.file-list');
	$schemeTab.on('click',function(){
		fnTab($(this).index())
	});
	function fnTab(index){
		$schemeTab.eq(index).attr('class','active').siblings().attr('class', '');
		$schemeList.eq(index).removeClass('hide').siblings().addClass('hide');
	}
	$('#outcry').on('click',function(){
		fnTab(1)
	})
	
	//验证
	var $userName = $('#userName'),
		$schemeCycle = $('#scheme-cycle'),
		$schemePriceBox = $('#scheme-price-box'),
		$schemePrice = $('#scheme-price'),
		$schemeDescription = $('#scheme-description'),
		$pmobj = $('#pmobj');
	//验证信息
	var check_step = 0;
	var errMsg = {
        "reg_time": "请填写装修工期",
        "reg_price" : "请填写装修报价",
        "reg_dscription": "请填写方案说明",
        "reg_job": "必须有一位项目经理",
        "reg_product": "必须有一个作品效果图"
    };
    loadJobs();
	//验证函数
	function checkTime(){    //装修工期
    	var id = "reg_time";
    	var reg = /^[1-9]*[1-9][0-9]*$/;
		if(!!$.trim($schemeCycle.val())){
			if($schemeCycle.val() != 0){
				if(reg.test($schemeCycle.val())){
					return showOk($schemeCycle);
				}
			}
		}
     	return showError($schemeCycle,id);
    }
    function checkDescription(){    //方案说明
    	var id = "reg_dscription";
        if (!!$.trim($schemeDescription.val())) {
            return showOk($schemeDescription,id);
        }
        return showError($schemeDescription,id);
    }
	function checkProduct(){    //作品平面图个数
    	var id = "reg_product";
    	var $proItem = $fileListBox.find('.previews-item');
    	if($proItem.size()){
    		check_step--;
    		return true;
    	}
    	$fileListBox.find('.tips-info').html(errMsg[id]).removeClass('hide');
        return false;
    }
    function checkPrice(){    //报价
    	var id = "reg_price";
    	if(!!$schemePrice.html()){
    		check_step--;
    		return true;
    	}
    	$schemePriceBox.find('.tips-info').html(errMsg[id]).removeClass('hide');
        return false;
    }
    function chechJobs(){
    	var id = "reg_job";
    	var $value = $pmobj.find('.value');
    	if($value.size()){
    		check_step--;
    		return true;
    	}
    	$pmobj.find('.tips-info').html(errMsg[id]).removeClass('hide');
        return false;
    }
    //显示验证信息
   	function showError(obj,id, msg) {
        var msg = msg || errMsg[id];
        var parent = obj.closest('.m-item');
        parent.find('.tips-icon-ok').addClass('hide');
        parent.find('.tips-icon-err').removeClass('hide');
        parent.find('.tips-info').html(msg).removeClass('hide')
        return false;
    }
    function showOk(obj) {
    	var parent = obj.closest('.m-item');
        parent.find('.tips-icon-err').addClass('hide');
        if ($.trim(obj.val()) != ""){
        	parent.find('.tips-icon-ok').removeClass('hide');
        	parent.find('.tips-info').html('').addClass('hide')
        }
        check_step--;
        return true;
    }
    //事件操作
    $schemeCycle.on('blur',function(){
    	checkTime();
    });
    $schemeDescription.on('blur',function(){
    	checkDescription();
    })  
    $('#userName').html(userName);
	function loadJobs(){
		$.ajax({
			method: 'GET',
			url:RootUrl+'api/v1/designer/team',
			contentType : 'application/json; charset=utf-8',
			dataType: 'json',
			success: function(res){
				if(res['data'].length){
					var itme_typeArr = [];
					for (var i = 0; i < res['data'].length; i++) {
						itme_typeArr.push(res['data'][i].manager)
					};
					var pmobj = new  ComboBox({
						id : 'pmobj',
						list : itme_typeArr
					});
				}else{
					$pmobj.html('你还没有项目经理，<a href="design_team.html" target="_blank">点击添加</a>').css('border','none')
				}
		   	}
		});
	}
	//提交方案
	function submitScheme(){
		var schemeItem =new OnlinePrice({
			id : 'j-scheme-item',
			data : [{"item": "基础工程", "price": 0,"description":""},{"item": "水电工程", "price": 0,"description":""},{"item": "客餐厅及走道", "price": 0,"description":""},{"item": "主卧", "price": 0,"description":""},{"item": "厨房", "price": 0,"description":""},{"item": "安装工程", "price": 0,"description":""},{"item": "其他工程", "price": 0,"description":""},{"item": "设计费", "price": 0,"description":""}]
		});
		var aTr = $('#j-scheme-item').find('tr:gt(0)');
		$('#create-quotes').on('click',function(){
			var priceDetail = [];
			aTr.each(function(i, el) {
				var item = $(el).find('.td1').html() || "";
				var price = parseInt($(el).find('input').val()) || 0;
				var description = $(el).find('textarea').val() || "";
				priceDetail.push(
				{
					"item": item, 
					"price": price,
					"description" : description
				})
			});
			$('#scheme-price').html(moneyToNumFiled($('#allPrice').html())).data('detail',priceDetail);
			$schemePriceBox.find('.tips-info').html("").addClass('hide');
			fnTab(0)
		})
		$('#scheme-submit').removeClass('hide');
		$('#scheme-editor').addClass('hide');
		$('#scheme-submit').on('click',function(){
			check_step = 5;
			checkTime();
			chechJobs();
			checkDescription();
			checkPrice();
			checkProduct();
			if(check_step > 0){
				return false;
			}
			var images = []
			var aPreviewsItem = $('#j-file-list').find('.previews-item');
			aPreviewsItem.each(function(i,el){
				images.push($(el).data('imgid'))
			})
			$.ajax({
				method: 'POST',
				url:RootUrl+'api/v1/designer/plan',
				contentType : 'application/json; charset=utf-8',
				dataType: 'json',
				data : JSON.stringify({
				  "userid": userid,
				  "duration":parseInt($schemeCycle.val()),
				  "total_price":parseInt($schemePrice.html()),
				  "price_detail":$schemePrice.data('detail'),
				  "description":$schemeDescription.val(),
				  "manager": $pmobj.find('.value').html(),
				  "images" : images
				}),
				processData : false,
				success: function(res){
					if(res['msg'] === 'success'){
						window.location.href = 'design_scheme.html';
					}
			   	}
			});
			return false;
		})
	}
	function loadList(){
		$.ajax({
			method: 'GET',
			url:RootUrl+'api/v1/plan/'+userid,
			contentType : 'application/json; charset=utf-8',
			dataType: 'json',
			success: function(res){
				var data = res['data']
				if(data != null){
					$schemeCycle.val(data.duration)
					$schemePrice.html(data.total_price).data('detail',data.price_detail);
					$schemeDescription.val(data.description);
					$pmobj.find('.value').html(data.manager);
					$('#j-file-list').find('.previews-item').remove();
					var str = '';
					for (var i = 0,len = data.images.length; i < len; i++) {
						str += '<div class="previews-item" data-imgid="'+data.images[i]+'">'
								+'<span class="close"></span>'
								+'<div class="pic">'
								+'<img class="img" src="'+RootUrl+'api/v1/image/'+data.images[i]+'" alt="" />'
								+'</div>'
								+'</div>'
					};
					$fileList.append(str);
					var schemeItem = new OnlinePrice({
						id : 'j-scheme-item',
						data : data.price_detail
					});
					editorScheme();
				}
		   	}
		});
	}
	//修改方案
	function editorScheme(){
		var aTr = $('#j-scheme-item').find('tr:gt(0)');
		$('#create-quotes').on('click',function(){
			var priceDetail = [];
			aTr.each(function(i, el) {
				var item = $(el).find('.td1').html() || "";
				var price = parseInt($(el).find('input').val()) || 0;
				var description = $(el).find('textarea').val() || "";
				priceDetail.push(
				{
					"item": item, 
					"price": price,
					"description" : description
				})
			});
			$('#scheme-price').html(moneyToNumFiled($('#allPrice').html())).data('detail',priceDetail);
			$schemePriceBox.find('.tips-info').html("").addClass('hide');
			fnTab(0)
		})
		$('#scheme-submit').addClass('hide');
		$('#scheme-editor').removeClass('hide');
		$('#scheme-editor').on('click',function(){
			check_step = 5;
			checkTime();
			chechJobs();
			checkDescription();
			checkPrice();
			checkProduct();
			if(check_step > 0){
				return false;
			}
			var images = []
			var aPreviewsItem = $('#j-file-list').find('.previews-item');
			aPreviewsItem.each(function(i,el){
				images.push($(el).data('imgid'))
			})
			$.ajax({
				method: 'PUT',
				url:RootUrl+'api/v1/designer/plan',
				contentType : 'application/json; charset=utf-8',
				dataType: 'json',
				data : JSON.stringify({
				  "_id": userid,
				  "duration":parseInt($schemeCycle.val()),
				  "total_price":parseInt($schemePrice.html()),
				  "price_detail":$schemePrice.data('detail'),
				  "description":$schemeDescription.val(),
				  "manager": $pmobj.find('.value').html(),
				  "images" : images
				}),
				processData : false,
				success: function(res){
					if(res['msg'] === 'success'){
						window.location.href = 'design_scheme.html';
					}
			   	}
			});
			return false;
		})
	}
	//获取HTML5特性支持情况
	//图片上传
	var img_id_upload=[];//初始化数组，存储已经上传的图片名
	var i=0;//初始化数组下标
	var checkSupport = function(){
		var input = document.createElement('input');
		var fileSupport = !!(window.File && window.FileList);
		var xhr = new XMLHttpRequest();
		var fd = !!window.FormData;
		return 'multiple' in input && fileSupport && 'onprogress' in xhr && 'upload' in xhr && fd ? 'html5' : 'flash';
	};
	var uploaderUrl = RootUrl+'api/v1/image/upload';
	uploadImg('upload','fileToUpload',function(arr){
		var data = $.parseJSON(arr);
		var iCount = (new Date()).getTime();
		var str = '<div class="previews-item" data-imgid="'+data.data+'">'
				+'<span class="close"></span>'
				+'<div class="pic">'
				+'<img class="img" src="'+RootUrl+'api/v1/image/'+data.data+'" alt="" />'
				+'</div>'
				+'</div>'
		$fileList.append(str)
		$fileListBox.find('.tips-info').html("").addClass('hide');
	})
	function uploadImg(obj1,obj2,callback){
		if(checkSupport() === "html5"){
			$('#'+obj1).Huploadify({
				auto:true,
				fileTypeExts:'*.jpg;*.png',
				multi:false,
				formData:{key:123456,key2:'vvvv'},
				fileSizeLimit:1024,
				showUploadedPercent:true,//是否实时显示上传的百分比，如20%
				showUploadedSize:true,
				removeTimeout:1,
				fileObjName:'Filedata',
				buttonText : "",
				uploader:uploaderUrl,
				onUploadComplete:function(file, data, response){
					 callback(data)
				}
			});
		}else{
			$('#'+obj2).uploadify({
		    	'auto'     : true,
		    	'removeTimeout' : 1,
		        'swf'      : 'uploadify.swf',
		        'uploader' : RootUrl+'api/v1/image/upload',
		        'method'   : 'post',
				'buttonText' : '',
		        'multi'    : false,
		        'uploadLimit' : 10,
		        'width' : 250,
		        'height' : 250,
		        'fileTypeDesc' : 'Image Files',
		        'fileTypeExts' : '*.gif; *.jpg; *.png',
		        'fileSizeLimit' : '1024KB',
		        'onUploadSuccess' : function(file, data, response){
		               callback(data)
		        }
		    });
		}
	}

	//删除当前方案图片
	$('#j-file-list').delegate('.close','click',function(ev){
		ev.preventDefault();
		if(confirm("你确定要删除吗？删除不能恢复")){
			$(this).closest('.previews-item').remove();
		}
	})



	    /*
	    * 参数说明：
	    * number：要格式化的数字
	    * decimals：保留几位小数
	    * dec_point：小数点符号
	    * thousands_sep：千分位符号
	    * */
	function number_format(number, decimals, dec_point, thousands_sep) {
	    number = (number + '').replace(/[^0-9+-Ee.]/g, '');
	    var n = !isFinite(+number) ? 0 : +number,
	        prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
	        sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
	        dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
	        s = '',
	        toFixedFix = function (n, prec) {
	            var k = Math.pow(10, prec);
	            return '' + Math.ceil(n * k) / k;
	        };
	 
	    s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
	    var re = /(-?\d+)(\d{3})/;
	    while (re.test(s[0])) {
	        s[0] = s[0].replace(re, "$1" + sep + "$2");
	    }
	 
	    if ((s[1] || '').length < prec) {
	        s[1] = s[1] || '';
	        s[1] += new Array(prec - s[1].length + 1).join('0');
	    }
	    return s.join(dec);
	}

	function moneyToNumFiled(str){  
	    var num =$.trim(str).toString();  
	    if(num.length==0){  
	      return "0";  
	    }          
	    return num.replace(/,/g, "");    
	} 
</script>
<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?66d38d3af612ed7c0979211372aa9682";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
</script>