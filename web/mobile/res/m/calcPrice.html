<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
    <title></title>
    <link rel="stylesheet" href="bower_components/animate.css/animate.min.css">
    <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/calcPrice.css">
    <script src="bower_components/lib-flexible/build/flexible_css.js"></script>
    <script src="bower_components/lib-flexible/build/flexible.js"></script>
  </head>
  <body>
    <div class="content">
      <div class="homePage">
        <div class="headerImg">
          <p class="title">
            为您开启奇妙的装修之旅
          </p>
        </div>

        <p class="secondTitle">
          只需三步，即刻在线生成智能预算
        </p>
        <div class="fldContainer">
          <img src="img/calcPrice/icon_area.png" />
          <input id="fldArea" type="text" name="name" value="" placeholder="建筑面积">
          <span>㎡</span>
        </div>
        <div id="area-error-info"></div>
        <div class="btnContainer">
          <button type="button" class="btnSubmit">获取装修预算</button>
        </div>
      </div>
      <div class="calcPriceHouse none">
        <div class="houseType">
          <p class="title">
            请选择您中意的户型
          </p>
          <div class="iconPlusContainer">
            <img src="img/calcPrice/icon_plus.png" class="icon" alt="" />
            <img src="img/calcPrice/icon_plus.png" class="icon" alt="" />
            <img src="img/calcPrice/icon_plus.png" class="icon" alt="" />
            <img src="img/calcPrice/icon_plus.png" class="icon" alt="" />
          </div>
          <div class="houseValueContainer">
            <img src="img/calcPrice/icon_house.png" class="iconHouse" alt="" />
            <span class="houseValueNumber">2</span>
            <span class="houseValueName">室</span>
            <span class="houseValueNumber">1</span>
            <span class="houseValueName">厅</span>
            <span class="houseValueNumber">1</span>
            <span class="houseValueName">厨</span>
            <span class="houseValueNumber">1</span>
            <span class="houseValueName">卫</span>
          </div>
          <div class="iconMinusContainer">
            <img src="img/calcPrice/icon_minus.png" class="icon" alt="" />
            <img src="img/calcPrice/icon_minus.png" class="icon" alt="" />
            <img src="img/calcPrice/icon_minus.png" class="icon" alt="" />
            <img src="img/calcPrice/icon_minus.png" class="icon" alt="" />
          </div>
        </div>
        <div class="extraHouse">
          <p class="title">
            除主卧外，另外<span>2</span>个卧室用作<br/>（多选／必选）
          </p>
          <div class="extraHouseContainer">
          </div>
        </div>
        <div id="house-error-info"></div>
        <div class="btnContainer">
          <button type="button" class="btnSubmit">下一步</button>
        </div>
      </div>
      <div class="calcPriceStyle none">
        <p class="title">
          选择您的装修标签
        </p>
        <div class="decTagContainer">
          <div>
            <span class="iconRoomContainer"><img src="img/calcPrice/icon_ou_shi.png" class="iconRoom" alt="" /><p>欧式</p></span>
            <span class="iconRoomContainer"><img src="img/calcPrice/icon_zhong_shi.png" class="iconRoom" alt="" /><p>中式</p></span>
            <span class="iconRoomContainer"><img src="img/calcPrice/icon_xian_dai.png" class="iconRoom" alt="" /><p>现代</p></span>
            <span class="iconRoomContainer"><img src="img/calcPrice/icon_di_zhong_hai.png" class="iconRoom" alt="" /><p>地中海</p></span>
          </div>
          <div>
            <span class="iconRoomContainer"><img src="img/calcPrice/icon_mei_shi.png" class="iconRoom" alt="" /><p>美式</p></span>
            <span class="iconRoomContainer"><img src="img/calcPrice/icon_dong_nan_ya.png" class="iconRoom" alt="" /><p>东南亚</p></span>
            <span class="iconRoomContainer"><img src="img/calcPrice/icon_tian_yuan.png" class="iconRoom" alt="" /><p>田园</p></span>
          </div>
        </div>
        <div id="style-error-info"></div>
        <div class="btnContainer">
          <button type="button" class="btnSubmit">生成装修预算</button>
        </div>
      </div>
    </div>
    <footer class="footer">
      <img src="img/calcPrice/logo.png" alt="logo" />
      <a href="javascript:;">立即下载简繁家App</a>
    </footer>
    <div class="submitDataPane none">
      <div class="submitDataMask">
        <div class="mask">
        </div>
        <div class="submitDataForm">
          <p class="title">
            绑定手机号码
          </p>
          <form id="form-reg">
            <div>
              <div class="fldContainer">
                <label for="reg-account"></label>
                <input type="text" name="phone" id="reg-account" placeholder="请输入手机号码" />
              </div>
            </div>
            <div class="vCode">
              <div class="fldContainer">
                <label for="reg-VerifyCode"></label>
                <input type="text" name="code" id="reg-VerifyCode" placeholder="请输入验证码" />
              </div>
              <button type="button" class="vCodeBtn" id="getVerifyCode">获取验证码</button>
            </div>
            <div id="submit-error-info"></div>
            <div class="btnContainer">
              <button type="button" class="btnSubmit">开启简繁家装修之旅</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="bower_components/jquery/dist/jquery.min.js"></script>
    <script src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      /** 对象初始化 **/
      var calcPriceData = {
        phone:"",
        living_room_count:3,
        cloakroom_count:2,
        kitchen_count:1,
        washroom_count:1,
        extra_bedroom_count:0,
        child_bedroom_count:0,
        study_room_count:0,
        dec_styles:[],
        house_area:0
      };

      /** 屏幕标签 **/
      var homePage = $('.homePage');
      var calcPriceHouse = $('.calcPriceHouse');
      var calcPriceStyle = $('.calcPriceStyle');
      var submitDataPane = $('.submitDataPane');

      var homePageTag = 'homePageTag';
      var calcPriceHouseTag = 'calcPriceHouseTag';
      var calcPriceStyleTag = 'calcPriceStyleTag';

      /** 错误 **/
      var areaErrorInfo = $('#area-error-info');
      var houseErrorInfo = $('#house-error-info');
      var styleErrorInfo = $('#style-error-info');
      var submitErrorInfo = $('#submit-error-info');

      /** 提交按钮 **/
      var submitArea = $('.homePage .btnSubmit');
      var submitHouse = $('.calcPriceHouse .btnSubmit');
      var submitStyle = $('.calcPriceStyle .btnSubmit');

      /**面积字段**/
      var fldArea = $('#fldArea');

      /** 户型 **/
      var roomNumber = $(".houseValueNumber:nth(0)");
      var cloakNumber = $(".houseValueNumber:nth(1)");
      var kitchenNumber = $(".houseValueNumber:nth(2)");
      var washroomNumber = $(".houseValueNumber:nth(3)");

      var plusRoomNumber = $(".iconPlusContainer .icon:nth(0)");
      var plusCloakNumber = $(".iconPlusContainer .icon:nth(1)");
      var plusKitchenNumber = $(".iconPlusContainer .icon:nth(2)");
      var plusWashroomNumber = $(".iconPlusContainer .icon:nth(3)");

      var minusRoomNumber = $(".iconMinusContainer .icon:nth(0)");
      var minusCloakNumber = $(".iconMinusContainer .icon:nth(1)");
      var minusKitchenNumber = $(".iconMinusContainer .icon:nth(2)");
      var minusWashroomNumber = $(".iconMinusContainer .icon:nth(3)");

      var extraHouse = $(".extraHouse");
      var extraHouseNumber = $(".extraHouse .title span");
      var extraHouseContainer = $(".extraHouseContainer");

      /** 用户方法 **/
      function initHouse(refreshExtra) {
        roomNumber.html(calcPriceData.living_room_count);
        cloakNumber.html(calcPriceData.cloakroom_count);
        kitchenNumber.html(calcPriceData.kitchen_count);
        washroomNumber.html(calcPriceData.washroom_count);

        if (refreshExtra === true) {
          extraHouseContainer.html(extraHouseContainerHtml());
          if (calcPriceData.living_room_count === 1) {
            extraHouse.addClass('none');
          } else {
            extraHouseNumber.html(calcPriceData.living_room_count - 1);
            extraHouse.removeClass('none');
          }
        }
      }

      function extraHouseContainerHtml(){
        var arr = [];
        if (calcPriceData.living_room_count >= 3) {
          arr.push('<div>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_living_room.png" class="iconRoom" alt="" /><p>次卧</p><div class="hoverContainer">'+hover('次卧')+'</div></span>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_living_room.png" class="iconRoom" alt="" /><p>次卧</p><div class="hoverContainer">'+hover('次卧')+'</div></span>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_child_room.png" class="iconRoom" alt="" /><p>儿童房</p><div class="hoverContainer">'+hover('儿童房')+'</div></span>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_child_room.png" class="iconRoom" alt="" /><p>儿童房</p><div class="hoverContainer">'+hover('儿童房')+'</div></span>');
          arr.push('</div>');
          arr.push('<div>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_book_room.png" class="iconRoom" alt="" /><p>书房</p><div class="hoverContainer">'+hover('书房')+'</div></span>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_cloth_room.png" class="iconRoom" alt="" /><p>衣帽间</p><div class="hoverContainer">'+hover('衣帽间')+'</div></span>');
          arr.push('</div>');
        } else {
          arr.push('<div>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_living_room.png" class="iconRoom" alt="" /><p>次卧</p><div class="hoverContainer">'+hover('次卧')+'</div></span>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_child_room.png" class="iconRoom" alt="" /><p>儿童房</p><div class="hoverContainer">'+hover('儿童房')+'</div></span>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_book_room.png" class="iconRoom" alt="" /><p>书房</p><div class="hoverContainer">'+hover('书房')+'</div></span>');
          arr.push('<span class="iconRoomContainer"><img src="img/calcPrice/icon_cloth_room.png" class="iconRoom" alt="" /><p>衣帽间</p><div class="hoverContainer">'+hover('衣帽间')+'</div></span>');
          arr.push('</div>');
        }

        return arr.join('');
      }

      function hover(name) {
        return '<div class="hover">'
                  + '<div class="mask"></div>'
                    + '<div class="hoverContent"><img src="img/calcPrice/icon_checked.png" alt="" /><p>' + name + '</p>'
                  + '</div>'
                + '</div>'
      }

      /** 校验 **/
      var verify = {
          isMobile : function(mobile){
              return /^(13[0-9]{9}|15[012356789][0-9]{8}|18[0123456789][0-9]{8}|147[0-9]{8}|170[0-9]{8}|177[0-9]{8})$/.test(mobile);
          },
          isArea : function(str){
              return (/^[\d]{1,3}$/.test(str));
          },
          isVerifyCode : function(str){
              return (/^[\d]{6}$/.test(str));
          }
      };

      var errmsg = {
          'mobile'  : '手机号不正确',
          'area' : '请输入正确的面积',
          'smscode'  : '短信验证码不正确',
      };

      /** 事件处理 **/
      plusRoomNumber.click(function () {
        if (calcPriceData.living_room_count < 4) {
          calcPriceData.living_room_count++;
          initHouse(true);
        }
      });

      plusCloakNumber.click(function () {
        if (calcPriceData.cloakroom_count < 2) {
          calcPriceData.cloakroom_count++;
          initHouse();
        }
      });

      plusKitchenNumber.click(function () {
        if (calcPriceData.kitchen_count < 2) {
          calcPriceData.kitchen_count++;
          initHouse();
        }
      });

      plusWashroomNumber.click(function () {
        if (calcPriceData.washroom_count < 2) {
          calcPriceData.washroom_count++;
          initHouse();
        }
      });

      minusRoomNumber.click(function () {
        if (calcPriceData.living_room_count > 1) {
          calcPriceData.living_room_count--;
          initHouse(true);
        }
      });

      minusCloakNumber.click(function () {
        if (calcPriceData.cloakroom_count > 1) {
          calcPriceData.cloakroom_count--;
          initHouse();
        }
      });

      minusKitchenNumber.click(function () {
        if (calcPriceData.kitchen_count > 1) {
          calcPriceData.kitchen_count--;
          initHouse();
        }
      });

      minusWashroomNumber.click(function () {
        if (calcPriceData.washroom_count > 1) {
          calcPriceData.washroom_count--;
          initHouse();
        }
      });

      submitArea.click(function () {
        if(verify.isArea(fldArea.val())){
          areaErrorInfo.html('');
          areaErrorInfo.removeClass('error');

          calcPriceData.area = fldArea.val();
          initHouse(true);
          pushToHouse();
          pushState(homePageTag, calcPriceHouseTag);
        } else{
          areaErrorInfo.html(errmsg.area);
          areaErrorInfo.addClass('error');
          calcPriceData.area = 0;
        }
      });

      submitHouse.click(function () {
        pushToStyle();
        pushState(calcPriceHouseTag, calcPriceStyleTag);
      });

      submitStyle.click(function () {
        submitDataPane.removeClass('none');
      });

      /** 切屏动画 */
      function popToHome() {
        animateView(homePage, 'slideInLeft');
        animateView(calcPriceHouse, 'slideOutRight');
      }

      function pushToHouse() {
        animateView(homePage, 'slideOutLeft');
        animateView(calcPriceHouse, 'slideInRight');
      }

      function popToHouse() {
        animateView(calcPriceHouse, 'slideInLeft');
        animateView(calcPriceStyle, 'slideOutRight');
      }

      function pushToStyle() {
        animateView(calcPriceHouse, 'slideOutLeft');
        animateView(calcPriceStyle, 'slideInRight');
      }

      function animateView(element, clz) {
        element.removeClass('none');
        var animateValue = clz + ' animated';
        element.removeClass('slideOutLeft slideOutRight slideInLeft slideInRight animated');
        element.addClass(animateValue);
      }

      function pushState(preS, curS) {
        var state = {pre:preS};
        window.history.replaceState(state, null, null);
        window.history.pushState(null, curS, null);
      }

      window.addEventListener('popstate', function (e) {
        var state = e.state;
        if (!state) return;
        var preState = state.pre;
        if (preState === homePageTag) {
          popToHome();
        } else if (preState === calcPriceHouseTag) {
          popToHouse();
        }
      });
    </script>
  </body>
</html>
